<%-include("../layout/userheader.ejs")-%>
<style>
    .card img{
        max-height: 200px;
    }
</style>
<%-include("../layout/usercentre.ejs")-%>
<%-include("../partials/usernavbar.ejs")-%>
<section class="" style="padding-top: 84px;">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-3" style="max-width: 300px;">
                <!-- Toggle button -->
                <form action="\filter" method="post" id="filterForm">
                    <button class="btn btn-outline-secondary mb-3 w-100 d-lg-none" type="button" data-mdb-toggle="collapse"
                            data-mdb-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                            aria-expanded="false" aria-label="Toggle navigation">
                        <span>Show filter</span>
                    </button>
                    <!-- Collapsible wrapper -->
                    <div class="collapse card d-lg-block mb-5" style="background-color: white;"
                        id="navbarSupportedContent">
                        <div class="accordion" id="accordionPanelsStayOpenExample">
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="headingTwo">
                                    <button class="accordion-button text-dark bg-light" type="button"
                                            data-mdb-toggle="collapse" data-mdb-target="#panelsStayOpen-collapseTwo"
                                            aria-expanded="true" aria-controls="panelsStayOpen-collapseTwo">
                                        Categories
                                    </button>
                                </h2>
                                <div id="panelsStayOpen-collapseTwo" class="accordion-collapse collapse show"
                                    aria-labelledby="headingTwo">
                                    <div class="accordion-body">
                                        <div>
                                            <!-- Checked checkbox -->
                                            <% categories.forEach(ele=> { %>
                                            <% if (ele.Status=="Show") { %>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" name="Ctgory"
                                                    value="<%-ele._id-%>" id="flexCheckChecked1" />
                                                <label class="form-check-label" for="flexCheckChecked1">
                                                    <%-ele.categoryname-%></label>
                                                <span class="badge badge-secondary float-end"><%-ele.count-%></span>
                                            </div>
                                            <% } %>
                                            <% }) %>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- 2nd one -------------------------------- -->

                            <div class="accordion-item">
                                <h2 class="accordion-header" style="background-color: white;" id="headingThree">
                                    <button class="accordion-button text-dark bg-light" type="button"
                                            data-mdb-toggle="collapse" data-mdb-target="#panelsStayOpen-collapseThree"
                                            aria-expanded="false" aria-controls="panelsStayOpen-collapseThree">
                                        Price
                                    </button>
                                </h2>
                                <div id="panelsStayOpen-collapseThree" class="accordion-collapse collapse show"
                                    style="background-color: white;" aria-labelledby="headingThree">
                                    <div class="accordion-body">
                                        <div class="range">
                                            <input type="range" class="form-range" id="priceRange" min="0"
                                                max="10000" oninput="updateMaxPrice()" />
                                        </div>
                                        <div class="row mb-3">

                                            <div class="col-6">

                                                <p class="mb-0">
                                                    Min
                                                </p>
                                                <div class="form-outline">
                                                    <input type="number" id="minPrice" name="min" class="form-control"
                                                        value="0" readonly />
                                                    <label class="form-label" for="typeNumber">₹ 0</label>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <p class="mb-0">
                                                    Max
                                                </p>
                                                <div class="form-outline">
                                                    <input type="number" id="maxPrice" name="max" value="10000"
                                                        class="form-control" readonly />
                                                    <label class="form-label" for="typeNumber">₹ 100,00</label>
                                                </div>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-white w-100 border border-secondary"
                                            onclick="filter(event,'<%= searchTerm %>')">apply</button>
                                        <!-- form end ---------------------------------------------------------------------- -->
                                    </div>
                                </div>
                            </div>

                            <!-- Ratings -->
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="headingFour">
                                    <button class="accordion-button text-dark bg-light" type="button"
                                            data-mdb-toggle="collapse" data-mdb-target="#panelsStayOpen-collapseFour"
                                            aria-expanded="false" aria-controls="panelsStayOpen-collapseFour">
                                        Ratings
                                    </button>
                                </h2>
                                <div id="panelsStayOpen-collapseFour" class="accordion-collapse collapse show"
                                    aria-labelledby="headingFour">
                                    <div class="accordion-body">
                                        <!-- Default checkbox -->
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault"
                                                checked />
                                            <label class="form-check-label" for="flexCheckDefault">
                                                <i class="bi bi-star-fill text-warning"></i><i
                                                    class="bi bi-star-fill text-warning"></i><i
                                                    class="bi bi-star-fill text-warning"></i><i
                                                    class="bi bi-star-fill text-warning"></i>
                                                <i class="bi bi-star-fill text-warning"></i>
                                            </label>
                                        </div>
                                        <!-- Default checkbox -->
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault"
                                                checked />
                                            <label class="form-check-label" for="flexCheckDefault">
                                                <i class="bi bi-star-fill text-warning"></i><i
                                                    class="bi bi-star-fill text-warning"></i><i
                                                    class="bi bi-star-fill text-warning"></i><i
                                                    class="bi bi-star-fill text-warning"></i>
                                                <i class="bi bi-star-fill text-secondary"></i>
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault" checked />
                                            <label class="form-check-label" for="flexCheckDefault">
                                              <i class="bi bi-star-fill text-warning"></i><i class="bi bi-star-fill text-warning"></i><i class="bi bi-star-fill text-warning"></i><i class="bi bi-star-fill text-secondary"></i>
                                              <i class="bi bi-star-fill text-secondary"></i>
                                            </label>
                                          </div>
                                          <!-- Default checkbox -->
                                          <div class="form-check">
                                              <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault" checked />
                                              <label class="form-check-label" for="flexCheckDefault">
                                                <i class="bi bi-star-fill text-warning"></i> <i class="bi bi-star-fill text-warning"></i><i class="bi bi-star-fill text-secondary"></i><i class="bi bi-star-fill text-secondary"></i>
                                                <i class="bi bi-star-fill text-secondary"></i>
                                              </label>
                                          </div>
                                          <!-- Default checkbox -->
                                          <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault" checked />
                                            <label class="form-check-label" for="flexCheckDefault">
                                              <i class="bi bi-star-fill text-warning"></i> <i class="bi bi-star-fill text-secondary"></i><i class="bi bi-star-fill text-secondary"></i><i class="bi bi-star-fill text-secondary"></i>
                                              <i class="bi bi-star-fill text-secondary"></i>
                                            </label>
                                          </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <!-- content -->
            <div class="col-lg-9" style="padding: 50px;">
                <% if (searchTerm) { %>
                    <h3>Search Results for "<%= searchTerm %>"</h3>
                <% } %>

                <div class="row" id="gridViewSection">
                    <% searchvalues.forEach(data => { %>
                        <div class="col-lg-4 col-md-6 col-sm-6 my-2">
                            <div class="card shadow" style="max-width: 250px; max-height: 400px;">
                                <img src="/productimages/<%= data.images[0] %>" class="card-img-top" />
                                <div class="card-body">
                                    <h6 style="font-size: 18px;"><%-data.productName-%></h6>
                                    <div class="d-flex flex-row">
                                        <h6 class="mb-1 me-1">₹ <%-data.price-data.discountAmount-%></h6>
                                        <span class="text-danger"><s>₹ <%-data.price-%></s></span>
                                    </div>
                                    <p class="card-text">Category: <%= data.Category.categoryname%><span
                                            style="margin-left: 10px"> </span></p>
                                    <div class="d-flex justify-content-end" style="margin-top: 5px;">
                                        <% if (locals.username) { %>
                                            <a href="/uniqueproduct/<%-data._id-%>"
                                                class="btn btn-outline-primary shadow-0 me-1">View</a>
                                        <% } else { %>
                                            <a href="/singleproductnouser/<%-data._id-%>"
                                                class="btn btn-outline-primary shadow-0 me-1">View</a>
                                        <% } %>
                                        <a class="btn btn-light border  icon-hover px-2 pt-2"
                                            onclick="addToWishlist('<%-data._id-%>')"><i
                                                class="bi bi-heart text-secondary px-1"></i></a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <% }) %>
                </div>
                <% if (flag==0) { %>
                    <nav aria-label="Page navigation example" class="d-flex justify-content-center mt-3">
                      <ul class="pagination">
                        <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
                          <a class="page-link" href="?page=<%= currentPage - 1 %><%= existingQueryString %>" aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                          </a>
                        </li>
                    
                        <% for (let i = 1; i <= totalpages; i++) { %>
                          <li class="page-item <%= currentPage === i ? 'active' : '' %>">
                            <a class="page-link" href="?page=<%= i %><%= existingQueryString %>"><%= i %></a>
                          </li>
                        <% } %>
                    
                        <li class="page-item <%= currentPage === totalpages ? 'disabled' : '' %>">
                          <a class="page-link" href="?page=<%= currentPage + 1 %><%= existingQueryString %>" aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                          </a>
                        </li>
                      </ul>
                    </nav>
                    <%} else { %>
                      <nav aria-label="Page navigation example" class="d-flex justify-content-center mt-3">
                        <ul class="pagination">
                          <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
                            <a class="page-link" href="?page=<%= currentPage - 1 %><%= existingQueryString %>" aria-label="Previous">
                              <span aria-hidden="true">&laquo;</span>
                            </a>
                          </li>
                        
                          <% for (let i = 1; i <= totalpages; i++) { %>
                            <li class="page-item <%= currentPage === i ? 'active' : '' %>">
                              <a class="page-link" href="?page=<%= i %><%= existingQueryString %>"><%= i %></a>
                            </li>
                          <% } %>
                        
                          <li class="page-item <%= currentPage === totalpages ? 'disabled' : '' %>">
                            <a class="page-link" href="?page=<%= currentPage + 1 %><%= existingQueryString %>" aria-label="Next">
                              <span aria-hidden="true">&raquo;</span>
                            </a>
                          </li>
                        </ul>
                      </nav>
                      <% } %>
            </div>
        </div>
    </div>
</section>
<script>
    function updateMaxPrice() {
      const priceRange = document.getElementById('priceRange');
      const maxPriceInput = document.getElementById('maxPrice');
    
      maxPriceInput.value = priceRange.value;
      updateLabel(maxPriceInput);
    }
    function filter(event,searchterm) {
      event.preventDefault(); // Prevent the default form submission behavior

      // Get the values from the form inputs
      var categoryCheckboxes = document.querySelectorAll('input[name="Ctgory"]:checked');

      var minPrice = document.getElementById('minPrice').value;
      var maxPrice = document.getElementById('maxPrice').value;
    
 
      var formData = new FormData(document.getElementById('filterForm'));
      var queryString = new URLSearchParams(formData).toString();
      console.log(queryString); 
     
      window.location.href = '/searchfilter?' + queryString + "&search="+searchterm;
    }
</script>
<%-include("../layout/userfooter.ejs")-%>

