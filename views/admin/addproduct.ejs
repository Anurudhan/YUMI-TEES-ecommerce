<%-include("../layout/adminheader.ejs")-%>
<%-include("../layout/admincentre.ejs")-%>

<%-include("../partials/adminnavbar.ejs")-%>
<form action="/admin/addProducts" method="post" enctype="multipart/form-data">
    <div class="container" style="margin-top: 90px;">
        <div class="row p-3 d-flex justify-content-center align-items-center shadow-lg mt-4" style="border-radius: 15px;height: 80vh;">
        <div class="col-12 col-md-6 "
            style="border-radius: 15px;">
            <div class="d-flex justify-content-center align-items-center" style="background-color: rgb(25, 27, 36); border-radius: 10px 10px 0 0 ;">
                <h1 style="color: rgb(255, 255, 255);">Add Product</h1>
            </div>
            <div class="d-flex mt-4 justify-content-center align-items-center">
                <input type="text" name="productName" placeholder="Product Name" id="name"
                    style="width: 80%;height: 35px;border-radius: 5px;padding-left: 5px;" required>
            </div><br>
            <div class="d-flex justify-content-center align-items-center">
                <select class="" id="category" name="Category" required
                    style="width:38%;height: 35px;border-radius: 5px;margin-right: 4%;">
                    <option value="" selected disabled>Select a category</option>
                    <%category.forEach((x) => {%>
                        <option value="<%= x._id%>"><%=x.categoryname%></option>
                    <%})%>
                </select>
            </div>
            <br>
            <div class="d-flex">

            </div>

            <div class="d-flex justify-content-center">
                <textarea name="Specification1" placeholder="Specification1" id="spec1"
                    style="width: 38%;height: 35px;border-radius: 5px;padding-left: 5px;margin-right: 4%;" required></textarea>
                <textarea name="Specification2" placeholder="Specification2" id="spec2"
                    style="width: 38%;height: 35px;border-radius: 5px;padding-left: 5px;" required></textarea>
            </div>
            <br>
            <div class="d-flex justify-content-center">
                <textarea name="Specification3" placeholder="Specification3" id="spec3"
                    style="width: 38%;height: 35px;border-radius: 5px;padding-left: 5px;margin-right: 4%;" required></textarea>
                <textarea name="Specification4" placeholder="Specification4" id="spec4"
                    style="width: 38%;height: 35px;border-radius: 5px;padding-left: 5px;" required></textarea>
            </div>
            <input type="hidden" value="false" name="inWish">
            <br>
            <div class="d-flex justify-content-center align-items-center">
                <textarea name="Description" placeholder="Description" id="desc"
                    style="width: 80%;height: 35px;border-radius: 5px;padding-left: 5px;" required></textarea>
            </div>
            </div>
            <br>
            <div class="col-12 col-md-6 pt-3  "
            style="border-radius: 15px;">
            <div class="d-flex justify-content-center align-items-center">
                <input type="number" name="price" placeholder="Enter the price" id="price"
                    style="width: 26%;height: 35px;border-radius: 5px;padding-left: 5px;margin-right: 4%;" required>
                <input type="number" name="discountAmount" placeholder="Discount Amount" id="discountAmount"
                    style="width: 26%;height: 35px;border-radius: 5px;padding-left: 5px;margin-right: 4%;" required>
                <input type="number" name="stockQuantity" placeholder="Stock" id="stockquantity"
                    style="width: 20%;height: 35px;border-radius: 5px;padding-left: 5px;" required>
            </div>
            <br>
            <div class="d-flex justify-content-center align-items-center" >
                <input type="file" name="image1" id="imageInput1" accept="image/*" onchange="change(event,1)"
                    style="width: 38%;height: 35px;border-radius: 5px;padding-left: 5px;margin-right: 4%;" oninput="validateImage('imageInput1',1)" required>
                <input type="file" name="image2" id="imageInput2" accept="image/*" onchange="change(event,2)"
                    style="width: 38%;height: 35px;border-radius: 5px;padding-left: 5px;" oninput="validateImage('imageInput2',2)" required>
            </div>
            <br>
            <div class="d-flex justify-content-center align-items-center">
                <input type="file" name="image3" id="imageInput3" accept="image/*" oninput="validateImage('imageInput3',3)" onchange="change(event,3)"
                    style="width: 38%;height: 35px;border-radius: 5px;padding-left: 5px; margin-right: 4%;" required>
                
                <input type="file" name="image4" id="imageInput4" accept="image/*" oninput="validateImage('imageInput4',4)" onchange="change(event,4)"
                    style="width: 38%;height: 35px;border-radius: 5px;padding-left: 5px;" required>
            </div>
            <div class="d-flex justify-content-center p-3">
                <div style="width: 100px;height: 100px;margin-right: 4%;margin-left: 4%; border: 1px solid grey;">
                    <img id="imagePreview1" src="" alt="Image Preview 1"
                        style="width: 100px; height: 100px;">
                </div>
                <div style="width: 100px;height: 100px;margin-right: 4%; border: 1px solid grey;">
                    <img id="imagePreview2" src="" alt="Image Preview 2"
                        style="width: 100px; height: 100px;">
                </div>
                <div style="width: 100px;height: 100px;margin-right: 4%; border: 1px solid grey;">
                    
                    <img id="imagePreview3" src="" alt="Image Preview 3"
                        style="width: 100px;height: 100px;">
                </div>
                <div style="width: 100px;height: 100px; border: 1px solid grey;">
                    <img id="imagePreview4" src="" alt="Image Preview 4"
                        style="width: 100px; height: 100px;">
                </div>
            </div>
            <div class="d-flex justify-content-center align-items-center">
                <input name="tags" placeholder="Tags"
                    style="width: 80%;height: 35px;border-radius: 5px;padding-left: 5px;" required></input>
            </div>
            <div class="d-flex justify-content-center mt-4">
                <button type="submit" class="btn" style="background-color: rgb(36, 80, 255);color: white;">Add Product</button>
            </div>
        </div>
    </div>
</div>
</div>
</form>
<script>
     function change(event,no){
        console.log("ok da")
        var fileInput = event.target;
        var allowedExtensions = /(\.jpg|\.jpeg|\.png|\.gif)$/i;
        if (!allowedExtensions.exec(fileInput.value)){
            alert('!Please upload only image files (jpg, jpeg, png, gif).');
            fileInput.value = '';
            return false;
        }

        document.getElementById(`imagePreview${no}`).src=URL.createObjectURL(fileInput.files[0])
        return true;
      
     }
</script>
<script>
    const priceInput = document.getElementById('price');
    const discountInput = document.getElementById('discountAmount');
    const stockInput = document.getElementById("stockquantity")
    const nameInput = document.getElementById("name")
    const spec1Input = document.getElementById('spec1')
    const spec2Input = document.getElementById('spec2')
    const spec3Input = document.getElementById('spec3')
    const spec4Input = document.getElementById('spec4')
    const descInput = document.getElementById('desc')

    priceInput.addEventListener('input', validatePrice);
    discountInput.addEventListener('input', validatePrice);
    stockInput.addEventListener('input', validatestock);
    nameInput.addEventListener('input',validateTrim)
    spec1Input.addEventListener('input',validateTrim)
    spec2Input.addEventListener('input',validateTrim)
    spec3Input.addEventListener('input',validateTrim)
    spec4Input.addEventListener('input',validateTrim)
    descInput.addEventListener('input',validateTrim)


    function validatePrice() {
        const price = parseFloat(priceInput.value);
        const discount = parseFloat(discountInput.value);

        if (price <= discount) {
            priceInput.setCustomValidity('Price must be greater than discount amount.');
        }else if(price<0){
            priceInput.setCustomValidity('Price must be more than zero') 
        }else if(discount<0){
            discountInput.setCustomValidity('discount must be more than or equal to zero')
        }
        else {
            priceInput.setCustomValidity('');
            discountInput.setCustomValidity('');
        }
    }
    function validatestock() {
        const stock = parseFloat(stockInput.value)
        if(stock < 0) stockInput.setCustomValidity('Stock must be more than or equal to zero');
        else stockInput.setCustomValidity('');
    }
    function validateTrim(){
        const name = nameInput.value
        if(name.trim()===""){
            nameInput.setCustomValidity("Fields cannot contain only spaces. Please enter valid values.")
        }
        else if(!/^[a-zA-Z\s]+$/.test(name)){
            nameInput.setCustomValidity("Fields cannot contain numbers.")
        }
        else if(spec1Input.value.trim()===""){
            spec1Input.setCustomValidity("Fields cannot contain only spaces. Please enter valid values.")
        }
        else if(spec2Input.value.trim()===""){
            spec2Input.setCustomValidity("Fields cannot contain only spaces. Please enter valid values.")
        }
        else if(spec3Input.value.trim()===""){
            spec3Input.setCustomValidity("Fields cannot contain only spaces. Please enter valid values.")
        }
        else if(spec4Input.value.trim()===""){
            spec4Input.setCustomValidity("Fields cannot contain only spaces. Please enter valid values.")
        }
        else if (descInput.value.trim()===""){
            descInput.setCustomValidity("Fields cannot contain only spaces. Please enter valid values.")
        }
        else{
            nameInput.setCustomValidity("")
            spec1Input.setCustomValidity("")
            spec2Input.setCustomValidity("")
            spec3Input.setCustomValidity("")
            spec4Input.setCustomValidity("")
            descInput.setCustomValidity("")
        }
    }
</script>
<%-include("../layout/adminfooter.ejs")-%>